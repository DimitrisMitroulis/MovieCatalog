<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Search Page</title>
    <script
        src="https://code.jquery.com/jquery-3.6.3.js"
        integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
        crossorigin="anonymous">
    </script>
    <link rel="stylesheet" href="./assets/styles.css"/>
  </head>
  <body>
    <div class="container">
      <div class="search-container">
        <input
          onkeyup="sendData(this)"
          type="text"
          placeholder="Enter movie name here..."
          id="movie-name"
          value="">
        <button type="button"id="search-btn">Search</button>
  
      </div>
      <div id="result"></div>
    </div>    
    <% for(var i =0 ; i < res.movies.length ;i++){%>
      <hr class="solid">
      <div class="movie-block">
        <div class="movie-info">
          <h3 class="movie-title"><%= res.movies[i].title %></h3>
          <p class="movie-description"><%= res.movies[i].plot %></p>
          <p class="movie-rating">Rating: <%= res.movies[i].rating %>/10</p>
          <p class="movie-rating">ID: <%= res.movies[i]._id %>/10</p>
        </div>
      </div>
    <%}%>
    <section id = "searchResults">
    </section>
    <script>
      function sendData(e) {
        fetch('/search',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({payload:e.value})
          }).then(res => res.json()).then(data => {
            let payload = data.payload;
            searchResults.innerHTML = '';
            if(payload.length < 1 ){
                searchResults.innerHTML = '<p>Nothing Found</p>';
                return;
            }else{
                payload.forEach((item,index)=>{
                    if(index>0) searchResults.innerHTML += '<hr>';
                    searchResults.innerHTML += `<p>${item.title}</p>`;
                });
                return;
            }
      })
        
    }
    
    document.addEventListener("keydown", function(event) {
      if (event.keyCode === 13) {
        var e = document.getElementById("movie-name");

        fetch(`/search?search=${e.value.toString()}`)
        .then(response => {
          if (response.ok) {
            window.location.href = response.url;
          }
        })
      }
    });
    </script>
    
</body>
</html>